#!/usr/bin/cmake -P


# Generates .pro files for updating single .ts file from
# specified source files by invoking Qt lupdate tool later
# using MyUpdateTsFile.cmake script.
#
# Arguments:
#    PRO_FILE     - where .pro file should be generated
#    SOURCE_FILES - column separated list of source files
#    TS_FILE      - .ts file for which this .pro file is used
#    My_UTIL_SCRIPT - path to util macros to include


include( "${My_UTIL_SCRIPT}" )


# turn column separated list into normal lis
string( REPLACE ":" ";" _source_files "${SOURCE_FILES}" )


# make output directory
my_make_file_directory( "${PRO_FILE}" )


# write caption
file( WRITE "${PRO_FILE}"
	"#\n"
	"# This file is autogenerated by my_create_translation() macro\n"
	"# to update translation file: ${TS_FILE}\n"
	"#\n"
	"# All manual changes here will be lost.\n"
	"#\n"
)


# write HEADERS section
file( APPEND "${PRO_FILE}"
	"\n"
	"HEADERS =\\\n"
)

foreach ( _source_file ${_source_files} )
	get_filename_component( _source_file_ext "${_source_file}" EXT )
	if ( "${_source_file_ext}" STREQUAL ".h" OR "${_source_file_ext}" STREQUAL ".hpp" )
		file( APPEND "${PRO_FILE}" "  ${_source_file}\\\n" )
	endif()
endforeach()


# write SOURCES section
file( APPEND "${PRO_FILE}"
	"\n"
	"SOURCES =\\\n"
)

foreach ( _source_file ${_source_files} )
	get_filename_component( _source_file_ext "${_source_file}" EXT )
	if ( "${_source_file_ext}" STREQUAL ".cpp" OR "${_source_file_ext}" STREQUAL ".c" )
		file( APPEND "${PRO_FILE}" "  ${_source_file}\\\n" )
	endif()
endforeach()


# write FORMS section
file( APPEND "${PRO_FILE}"
	"\n"
	"FORMS =\\\n"
)

foreach ( _source_file ${_source_files} )
	get_filename_component( _source_file_ext "${_source_file}" EXT )
	if ( "_source_file_ext" STREQUAL ".ui" )
		file( APPEND "${PRO_FILE}" "  ${_source_file}\\\n" )
	endif()
endforeach()
